<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeenBot - Islamic AI Assistant</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* DeenBot specific styles only */

        .rag-assistant {
            background: linear-gradient(135deg, var(--dark-green), var(--medium-green));
            min-height: 100vh;
            padding: 8rem 0 2rem 0;
        }
        
        .rag-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .rag-header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }
        
        .rag-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--gold);
        }
        
        .rag-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .chat-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
        }
        
        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .message.user {
            background: var(--gold);
            color: var(--dark-green);
            margin-left: auto;
            text-align: right;
        }
        
        .message.assistant {
            background: rgba(255,255,255,0.1);
            color: white;
            margin-right: auto;
        }
        
        .message-header {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .message-content {
            line-height: 1.6;
        }
        
        .message-content .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.2rem;
            margin: 0.5rem 0;
            text-align: center;
            direction: rtl;
        }
        
        .message-content .reference {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .chat-input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
        }
        
        .chat-input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }
        
        .send-btn {
            background: var(--gold);
            color: var(--dark-green);
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .send-btn:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .quick-action {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .quick-action:hover {
            background: rgba(255,255,255,0.2);
            border-color: var(--gold);
            transform: translateY(-2px);
        }
        
        .quick-action-icon {
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 1rem;
        }
        
        .quick-action-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .quick-action-description {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }
        
        .suggestions {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .suggestions h3 {
            color: var(--gold);
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .suggestion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .suggestion-tag {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .suggestion-tag:hover {
            background: var(--gold);
            color: var(--dark-green);
            transform: translateY(-2px);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
            color: var(--gold);
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 0.5rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        
        .search-results {
            margin-top: 1rem;
        }
        
        .search-result {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--gold);
        }
        
        .search-result-title {
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }
        
        .search-result-content {
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
        }
        
        /* Groq Disclaimer Styles */
        .groq-disclaimer {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        .disclaimer-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ffc107;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .disclaimer-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* Sources Section Styles */
        .sources-section {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 3px solid var(--gold);
        }
        
        .sources-section strong {
            color: var(--gold);
            display: block;
            margin-bottom: 1rem;
        }
        
        .source-item {
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .source-link {
            color: var(--gold);
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.3s ease;
        }
        
        .source-link:hover {
            color: var(--gold-light);
        }
        
        .source-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.8rem;
            margin-top: 0.3rem;
            margin-left: 1.5rem;
        }

        @media (max-width: 768px) {
            .rag-header h1 {
                font-size: 2rem;
            }
            
            .chat-container {
                height: 400px;
                padding: 1rem;
            }
            
            .message {
                max-width: 90%;
            }
            
            .chat-input-container {
                flex-direction: column;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .suggestion-tags {
                justify-content: flex-start;
            }
            
            .groq-disclaimer {
                padding: 0.8rem;
            }
            
            .sources-section {
                padding: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <button class="back-btn" onclick="goBack()" title="Go Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="nav-logo">
                <i class="fas fa-mosque"></i>
                <span>Islamic Learning Companion</span>
            </div>
            <div class="nav-right">
                <button class="mobile-menu-btn" onclick="toggleMobileMenu()" title="Menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-content">
                <div class="mobile-menu-section">
                    <div class="mobile-menu-header" onclick="toggleDropdown('homeDropdown')">
                        <span>Home</span>
                        <i class="fas fa-chevron-down" id="homeChevron"></i>
                    </div>
                    <div class="mobile-dropdown" id="homeDropdown">
                        <a href="index.html" class="mobile-nav-link">Main Page</a>
                        <a href="complete-quran-reader.html" class="mobile-nav-link">Quran Reader</a>
                        <a href="rag-assistant.html" class="mobile-nav-link active">DeenBot</a>
                    </div>
                </div>
                <div class="mobile-menu-divider"></div>
                <a href="#" class="mobile-nav-link contact-link" onclick="showContactSheet()">Contact Us</a>
            </div>
        </div>
    </nav>

    <!-- RAG Assistant -->
    <section class="rag-assistant">
        <div class="rag-container">
            <div class="rag-header">
                <h1><i class="fas fa-mosque"></i> DeenBot</h1>
                <p>Your Islamic AI companion - Ask me anything about Islam, navigate the site, or find specific verses and hadiths</p>
            </div>



            <!-- Chat Interface -->
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message assistant">
                        <div class="message-header">
                            <i class="fas fa-mosque"></i> DeenBot
                        </div>
                        <div class="message-content">
                            <p><strong>Peace, mercy, and blessings of Allah be upon you.</strong></p>
                            <p>I am the program "Deen Bot". The developer is still working diligently to launch me in the required manner. We ask for your pardon and patience, and we ask Allah for success for us and for you.</p>
                        </div>
                    </div>
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Searching Islamic knowledge...</p>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything about Islam..." onkeypress="handleKeyPress(event)">
                    <button id="sendBtn" class="send-btn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                        Send
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Load Required Scripts -->
    <script src="js/secure-config.js"></script>
    <script src="js/local-config.js"></script>
    <script src="js/complete-quran-data.js"></script>
    <script src="hadiths.js"></script>
    <script src="js/comprehensive-islamic-knowledge.js"></script>
    <script src="js/comprehensive-islamic-knowledge-expanded.js"></script>
    <script src="js/extensive-islamic-knowledge.js"></script>
    <script src="js/specialized-islamic-knowledge.js"></script>
    <script src="js/detailed-quranic-hadith-database.js"></script>
    <script src="js/rag-system.js"></script>
    
    <script>
        let chatHistory = [];
        
        // Initialize the chat interface
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for RAG system to initialize
            setTimeout(() => {
                if (window.islamicRAG && window.islamicRAG.isInitialized) {
                    console.log('✅ RAG Assistant ready');
                } else {
                    console.log('⏳ RAG Assistant initializing...');
                }
            }, 2000);
        });
        
        // Handle Enter key press
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Send message function
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addMessage('user', message);
            input.value = '';
            
            // Show loading
            showLoading(true);
            
            try {
                // Get response from RAG system
                const response = await window.islamicRAG.getIntelligentResponse(message);
                
                // Add response to chat
                addMessage('assistant', response);
                
                // Store in history
                chatHistory.push({
                    user: message,
                    assistant: response,
                    timestamp: new Date()
                });
                
            } catch (error) {
                console.error('Error getting response:', error);
                addMessage('assistant', {
                    type: 'error',
                    message: 'Sorry, I encountered an error. Please try again.',
                    response_text: 'I apologize, but I\'m having trouble processing your request right now. Please try rephrasing your question or ask about Quran, Hadith, prayer, or site navigation.'
                });
            } finally {
                showLoading(false);
            }
        }
        
        // Add message to chat
        function addMessage(sender, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <i class="fas fa-user"></i> You
                    </div>
                    <div class="message-content">
                        ${content}
                    </div>
                `;
            } else {
                // Assistant response
                let messageContent = '';
                
                if (typeof content === 'string') {
                    messageContent = content;
                } else if (content.response_text) {
                    messageContent = content.response_text;
                    
                    // Add Groq disclaimer if Groq was used
                    if (content.groq_used && content.disclaimer) {
                        messageContent += `<div class="groq-disclaimer">
                            <div class="disclaimer-header">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>Important Notice</strong>
                            </div>
                            <div class="disclaimer-text">${content.disclaimer}</div>
                        </div>`;
                    }
                    
                    // Add sources if available (from Groq)
                    if (content.sources && content.sources.length > 0) {
                        messageContent += '<div class="sources-section">';
                        messageContent += '<strong><i class="fas fa-link"></i> Recommended Sources:</strong>';
                        content.sources.forEach(source => {
                            messageContent += `<div class="source-item">
                                <a href="${source.url}" target="_blank" class="source-link">
                                    <i class="fas fa-external-link-alt"></i>
                                    ${source.name}
                                </a>
                                <div class="source-description">${source.description}</div>
                            </div>`;
                        });
                        messageContent += '</div>';
                    }
                    
                    
                    // Add additional results
                    if (content.additional_results && content.additional_results.length > 0) {
                        messageContent += '<div class="search-results">';
                        messageContent += '<strong>Related results:</strong>';
                        content.additional_results.forEach(result => {
                            messageContent += `<div class="search-result">
                                <div class="search-result-title">${result.title || result.surah_english || result.source}</div>
                                <div class="search-result-content">${result.description || result.translation || result.english}</div>
                            </div>`;
                        });
                        messageContent += '</div>';
                    }
                } else {
                    messageContent = 'I\'m sorry, I couldn\'t process your request.';
                }
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <i class="fas fa-mosque"></i> DeenBot
                    </div>
                    <div class="message-content">
                        ${messageContent}
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Show/hide loading indicator
        function showLoading(show) {
            const loading = document.getElementById('loading');
            const sendBtn = document.getElementById('sendBtn');
            
            if (show) {
                loading.classList.add('show');
                sendBtn.disabled = true;
            } else {
                loading.classList.remove('show');
                sendBtn.disabled = false;
            }
        }
        
        // Quick question function
        async function askQuickQuestion(question) {
            document.getElementById('chatInput').value = question;
            await sendMessage();
        }
        
        // Navigate to page
        function navigateToPage(url) {
            window.location.href = url;
        }
        
        // Clear chat history
        function clearChat() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = `
                <div class="message assistant">
                    <div class="message-header">
                        <i class="fas fa-mosque"></i> DeenBot
                    </div>
                    <div class="message-content">
                        <p><strong>As-salamu alaykum!</strong> Chat cleared. How can I help you with Islamic knowledge today?</p>
                    </div>
                </div>
            `;
            chatHistory = [];
        }
        
        // Get system status
        function getSystemStatus() {
            if (window.islamicRAG) {
                const status = window.islamicRAG.getStatus();
                console.log('RAG System Status:', status);
                return status;
            }
            return null;
        }
        
        // Navigation functions
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index.html';
            }
        }
        
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('active');
        }
        
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const header = dropdown.previousElementSibling;
            const chevron = header.querySelector('i');
            
            dropdown.classList.toggle('active');
            header.classList.toggle('active');
        }
        
        function showContactSheet() {
            alert('Contact us at: support@islamicapp.com');
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const menuBtn = document.querySelector('.mobile-menu-btn');
            
            if (mobileMenu && !mobileMenu.contains(event.target) && !menuBtn.contains(event.target)) {
                mobileMenu.classList.remove('active');
            }
        });

        // Global functions for external access
        window.askQuickQuestion = askQuickQuestion;
        window.clearChat = clearChat;
        window.getSystemStatus = getSystemStatus;
        window.goBack = goBack;
        window.toggleMobileMenu = toggleMobileMenu;
        window.showContactSheet = showContactSheet;
    </script>
</body>
</html>
